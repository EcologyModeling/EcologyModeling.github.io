---
title: "Задания"
output:
  html_document:
    toc_float: false
    highlight: textmate
    includes:
      before_body: [include_header.html]
      after_body: [include_footer.html]
---

## Введение в R 


1. Вычислить среднее для каждой колонки таблицы iris, за исключением колонки "Species" и соберите результат в список (list).

2. Вычислить среднее для каждой строки, исключив перед этим колонку "Species" и сохраните результат в векторе.

3. Создайте случайные 1000 нуклеотидов, сохранив их в вектор DNA, посчитайте количество нуклеотидов A и T, их долю от общей длинны ДНК и запишите результат в вектор 'dna_at'

4. Создайте векто в котором записан произвольный набор латинских букв длинной не менее 10000 символов и посчитайте количество гласных.

5. Отсортируйте все виды в таблице iris по средней длинне лепестков. Результат должен быть фактором с градациями в виде имен видов с правильной последовательностью уровней.

6. Напишите функцию для рассчета медианы вектора самостоятельно.

7. Постройте график зависимости длины чашелистиков от длинны лепестков для каждого вида из таблицы iris

8. По данным таблицы 'diamonds'(пакет ggplot2 ) почитайте среднюю стоимость цены карата для бриллиантов дороже 1000$ для каждой категории яркости (clarity).

## Регрессионный и корелляционный анализы

1. Написать собственную функцию, которая бы для двух векторов одинакового объема считала бы коэффициент корелляции Спирмена  $r = 1 - \frac{6\sum_{i=1}^N d^2}{n(n^2 - 1)}$.  Для получения рангов ипользуйте функцию rank. Дополнительные балы для тех, кто сможет исользовать функцую match вместо rank.

2. Используя данные по [ссылке][l1], постройте оптимальную линейную модель множественной регрессии для co2_flux используя только данные летних месяцев. В данных вместо значения NA используется значения -9999, исправьте это действием подобным data[data == -9999] = NA. Для выбора нужных суток используйте переменную DOY - день года (1 января - DOY = 1)

## Задание 1 - Манипуляции с данными 

Исользуя пример ниже, где для столицы 71 региона скачиваются все имеющиеся климатические данные(ежедневные осадки и среднедневные температуры) для 20 близлежайших метеостанций, рассчитайте урожайность для указанного вам региона (координаты столицы найдите самостоятельно) по приведенным ниже уравнениям.

**Внимание все переменные в скачаных данных представлены в десятых долях единиц.**

```{r,echo=F, warning=FALSE}
library(knitr)
library(kableExtra)
```

```{r echo=TRUE, message=FALSE, warning=FALSE}
library(tidyverse)
library(rnoaa)
#station_data = ghcnd_stations() #Может занять несколько минут лучше выполнить один раз в месте с хорошим интернетом и сохранить результат
station_data = read.csv("station_data.csv")
#После получения всписка всех станций, получите список станций ближайших к столице вашего региона,создав таблицу с именем региона и координатами его столицы
tula = data.frame(id = "TULA", latitude = 54.186806,  longitude = 37.617995)
tula_around = meteo_nearby_stations(lat_lon_df = tula, station_data = station_data,
                       limit = 20, var = c("PRCP", "TAVG"),
                       year_min = 2008, year_max = 2018)
#tula_around это список единственным элементом которого является таблица, содержащая идентификаторы метеостанций отсортированных по их 
# удалленности от Тулы, очевидно что первым элементом таблицы будет идентификатор метеостанции Тулы, его то мы и попытаемся получить
tula_id = tula_around[["TULA"]][["id"]][1]
#Для получения всех данных с метеостанции, зная ее идентификатор, используйте след. команду
all_tula_data = meteo_tidy_ghcnd(stationid = tula_id)
```


Урожайность рассчитывается как 
$Y_j=10^6*\sum_{ }^{ }\frac{(F_i*d_i)*K_f}{(Q_j*L_j(100-E_j))}$

где:

$F_i=a_{fi}+b_{fi}*y*(S_{t>5℃})$

где: 

$y = 1,0$ – коэффициент для экпозиции склона - считаем что все поля идеально ровные;

$a_{fi}$ – константа, берется из табл. 1.;

$b_{fi}$ – константа, берется из табл. 1.;

$d_i$ – отношение числа дней i-го месяца, входящих в период вегетации культуры, к общему числу дней в месяце, берется из табл. 1.;

$K_f$ – коэффициент использования ФАР посевом - 300;

$Q_j$ – калорийность урожая  культуры - 1600 ;

$L_j$ – коэффициент «Сумма частей основной и побочной продукции - 2,2;

$E_j$ – коэффициент «Стандартная влажность культуры» - 25;

$i = \{1; 12\}$ – номер месяца (апрель -№4, май - №5…);

$S_{t>5°C}$ – сумма температур больше 5°C за i-ый месяц - находите самостоятельно по климатическим данным


```{r, echo=F, collapse=TRUE, }
PAR = tibble(m=c(1:12), afi=c(0, 0, 0, 32.11, 26.31, 25.64, 23.20, 18.73, 16.30, 13.83, 0, 0), bfi=c(0, 0, 0, 11.30, 9.26, 9.03, 8.16, 6.59, 5.73, 4.87, 0, 0), di = c(0, 0, 0, 0.33, 1, 1, 1, 0.32, 0, 0,0,0))
kable(PAR, caption="Таблица 1") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))
```

**ВНИМАНИЕ! Для успешного решения задачи внимательно прочитайте раздел "Манипуляции над данными" и просмотрите презентации по tidyverse !**

#### для 121 группы

1. Бородина Кира – для региона 32 				рассчитайте урожайность пшеницы в 	2015 году, 	взяв для рассчета средние суммы активных температур 	за предыдущие 5 лет, 	с 11 ближайших метеостанций	
2. Даниленко Анна – для региона 57				рассчитайте урожайность пшеницы в 	2005 году, 	взяв для рассчета средние суммы активных температур 	за предыдущие 10 лет, 	с  метеостанций в радиусе не более 90 км	
3. Зайцева Дарья – для региона 48				рассчитайте урожайность пшеницы в 	период с 2005 по 2015 год	взяв для рассчета средние суммы активных температур 	за эти годы, 	с 8 ближайших метеостанций	
4. Конах Марина – для региона 68				рассчитайте урожайность пшеницы в 	2006 году, 	взяв для рассчета средние суммы активных температур 	за текущий год, 	с 10 ближайших метеостанций	но убирая из рассчета активных температур дни с температурой выше 25 градусов
5. Михальцов Всеволод – для региона 64				рассчитайте урожайность пшеницы в 	2004 году, 	взяв для рассчета средние суммы активных температур 	за предыдущие 23 года, 	с 2 ближайших метеостанций	но рассчитав колонку di самостоятельно, как долю месяца, когда среднедневные температуры были выше 8 градусов, но учитывая, что посев не может начаться раньше середины апреля, а вегетация составляет 4 месяца
6. Попов Максим – для региона 31				рассчитайте урожайность пшеницы в 	период с  2000 по 2003 год	взяв для рассчета средние суммы активных температур 	за эти годы, 	с метеостанций на расстоянии от 60 до 150 км	
7. Рашкович Василий – для региона 36				рассчитайте урожайность пшеницы в 	2010 году, 	взяв для рассчета средние суммы активных температур 	за предыдущие 3 года, 	с 15 ближайших метеостанций	
8. Шамрай Елизавета – для региона 34				рассчитайте урожайность пшеницы в 	2009 году, 	взяв для рассчета средние суммы активных температур 	за текущий год, 	с 3 ближайших метеостанций	но рассчитав колонку di самостоятельно, как долю месяца, когда среднедневные температуры были выше 7 градусов, но учитывая, что посев не может начаться раньше середины апреля, а вегетация составляет 4 месяца
9. Эминян Геворк – для региона 61				рассчитайте урожайность пшеницы в 	1999 году, 	взяв для рассчета средние суммы активных температур 	за предыдущие 2 года, 	с  метеостанций в радиусе не более 100 км	
10. Чалве Джеф – для региона 8				рассчитайте урожайность пшеницы в 	2000 году, 	взяв для рассчета средние суммы активных температур 	за предыдущие 7 лет, 	с 10 ближайших метеостанций	но убирая из рассчета активных температур дни с температурой выше 27 градусов

#### для 122 группы

1. Габечая Валерия – для региона 30				рассчитайте урожайность пшеницы в 	2001 году, 	взяв для рассчета средние суммы активных температур 	за предыдущие 8 лет, 	с 12 ближайших метеостанций	но рассчитав колонку di самостоятельно, как долю месяца, когда среднедневные температуры были выше 8 градусов, но учитывая, что посев не может начаться раньше середины апреля, а вегетация составляет 3 месяца
2. Бейбалаев Абдулкафар – для региона 58				рассчитайте урожайность пшеницы в 	2002 году, 	взяв для рассчета средние суммы активных температур 	за предыдущие 5 лет, 	с  метеостанций в радиусе не более 140 км	
3. Джалилова Диля – для региона 64				рассчитайте урожайность пшеницы в 	период с 2002 по 2012 год	взяв для рассчета средние суммы активных температур 	за эти годы, 	с 18 ближайших метеостанций	
4. Осьминина Анна – для региона 73				рассчитайте урожайность пшеницы в 	2003 году, 	взяв для рассчета средние суммы активных температур 	за предыдущие 9 лет, 	с метеостанций на расстоянии от 70 до 210 км	
5. Петрова Ольга – для региона 63				рассчитайте урожайность пшеницы в 	2005 году, 	взяв для рассчета средние суммы активных температур 	за предыдущие 15 лет, 	с 19 ближайших метеостанций	
6. Петрова Полина – для региона 16				рассчитайте урожайность пшеницы в 	2011 году, 	взяв для рассчета средние суммы активных температур 	за текущий год, 	с 25 ближайших метеостанций	но убирая из рассчета активных температур дни с температурой ниже 10 градусов


#### для 123 группы

1. Завалихина Юлия – для региона 56				рассчитайте урожайность пшеницы в 	период с 2007 по 2015 год	взяв для рассчета средние суммы активных температур 	за эти годы, 	с метеостанций на расстоянии от 50 до 250 км	
2. Игралиев Фёдор – для региона 2				рассчитайте урожайность пшеницы в 	2016 году, 	взяв для рассчета средние суммы активных температур 	за предыдущие 12 лет, 	с 16 ближайших метеостанций	но убирая из рассчета активных температур дни с температурой выше 30 градусов
3. Минов Роман – для региона 74				рассчитайте урожайность пшеницы в 	2017 году, 	взяв для рассчета средние суммы активных температур 	за предыдущие 15 лет, 	с  метеостанций в радиусе не более 120 км	
4. Осеева Алина – для региона 45				рассчитайте урожайность пшеницы в 	2014 году, 	взяв для рассчета средние суммы активных температур 	за предыдущие 25 лет, 	с 2 ближайших метеостанций	но рассчитав колонку di самостоятельно, как долю месяца, когда среднедневные температуры были выше 7 градусов, но учитывая, что посев не может начаться раньше середины апреля, а вегетация составляет 4 месяца
5. Петрушина Виктория – для региона 72				рассчитайте урожайность пшеницы в 	2012 году, 	взяв для рассчета средние суммы активных температур 	за предыдущие 5 лет, 	с 30 ближайших метеостанций	
6. Морозова Ксения – для региона 55				рассчитайте урожайность пшеницы в 	2013 году, 	взяв для рассчета средние суммы активных температур 	за предыдущие 3  года, 	с метеостанций на расстоянии от 90 до 180 км	
7. Чиркова Анастасия – для региона 54				рассчитайте урожайность пшеницы в 	период с  2010 по 2013 год	взяв для рассчета средние суммы активных температур 	за эти годы, 	с 25 ближайших метеостанций	

#### для 124 группы

1. Антоненко Алексей – для региона 22				рассчитайте урожайность пшеницы в 	2014 году, 	взяв для рассчета средние суммы активных температур 	за текущий год, 	с 20 ближайших метеостанций	но рассчитав колонку di самостоятельно, как долю месяца, когда среднедневные температуры были выше 7 градусов, но учитывая, что посев не может начаться раньше середины апреля, а вегетация составляет 4 месяца
2. Белов Руслан – для региона 4				рассчитайте урожайность пшеницы в 	2017 году, 	взяв для рассчета средние суммы активных температур 	за предыдущие 7 лет, 	с 21 ближайших метеостанций	
3. Васильева Елизавета – для региона 17				рассчитайте урожайность пшеницы в 	2001 году, 	взяв для рассчета средние суммы активных температур 	за предыдущие 8 лет, 	с метеостанций на расстоянии от 60 до 150 км	
4. Волков Иван – для региона 3				рассчитайте урожайность пшеницы в 	период с  1999 по 2003 год	взяв для рассчета средние суммы активных температур 	за эти годы, 	с 12 ближайших метеостанций	но рассчитав колонку di самостоятельно, как долю месяца, когда среднедневные температуры были выше 8 градусов, но учитывая, что посев не может начаться раньше середины апреля, а вегетация составляет 3 месяца
5. Воршева Александра – для региона 75				рассчитайте урожайность пшеницы в 	2010 году, 	взяв для рассчета средние суммы активных температур 	за предыдущие 15 лет, 	с 23 ближайших метеостанций	
6. Гайдуков Сергей – для региона 28				рассчитайте урожайность пшеницы в 	2011 году, 	взяв для рассчета средние суммы активных температур 	за предыдущие 5 лет, 	с  метеостанций в радиусе не более 300 км	
7. Исмаил Хеба – для региона 79				рассчитайте урожайность пшеницы в 	2013 году, 	взяв для рассчета средние суммы активных температур 	за текущий год, 	с 14 ближайших метеостанций	но убирая из рассчета активных температур дни с температурой выше 30 градусов
8. Каршилов Никита – для региона 27				рассчитайте урожайность пшеницы в 	2012 году, 	взяв для рассчета средние суммы активных температур 	за предыдущие 9 лет, 	с 24 ближайших метеостанций	
9. Клюшина Ксения – для региона 25*				рассчитайте урожайность пшеницы в 	2003 году, 	взяв для рассчета средние суммы активных температур 	за предыдущие 12 лет, 	с метеостанций на расстоянии от 90 до 180 км	
10. Комаристая Станислава – для региона 23				рассчитайте урожайность пшеницы в 	2004 году, 	взяв для рассчета средние суммы активных температур 	за текущий год, 	с 19 ближайших метеостанций	
11. Машенцев Илья – для региона 26				рассчитайте урожайность пшеницы в 	2015 году, 	взяв для рассчета средние суммы активных температур 	за предыдущие 11 лет, 	с 30 ближайших метеостанций	но убирая из рассчета активных температур дни с температурой выше 25 градусов
12. Николаева Татьяна – для региона 5				рассчитайте урожайность пшеницы в 	2016 году, 	взяв для рассчета средние суммы активных температур 	за предыдущие 3 года, 	с  метеостанций в радиусе не более 250 км	
13. Охотникова Мария – для региона 82				рассчитайте урожайность пшеницы в 	период с 2009 по 2016 год	взяв для рассчета средние суммы активных температур 	за эти годы, 	с 18 ближайших метеостанций	
14. Пономарев Георгий – для региона 39				рассчитайте урожайность пшеницы в 	2016 году, 	взяв для рассчета средние суммы активных температур 	за предыдущие 13 лет, 	с 11 ближайших метеостанций	но убирая из рассчета активных температур дни с температурой выше 27 градусов
15. Смирнова Наталья – для региона 42				рассчитайте урожайность пшеницы в 	2008 году, 	взяв для рассчета средние суммы активных температур 	за предыдущие 5 лет, 	с метеостанций на расстоянии от 50 до 250 км	
16. Турчак Карина – для региона 19				рассчитайте урожайность пшеницы в 	2016 году, 	взяв для рассчета средние суммы активных температур 	за предыдущие 4 года, 	с 15 ближайших метеостанций	
17. Шевкунов Андрей – для региона 31				рассчитайте урожайность пшеницы в 	2006 году, 	взяв для рассчета средние суммы активных температур 	за текущий год, 	с 7 ближайших метеостанций	но рассчитав колонку di самостоятельно, как долю месяца, когда среднедневные температуры были выше 7 градусов, но учитывая, что посев не может начаться раньше середины апреля, а вегетация составляет 4 месяца
18. Шехватова Татьяна – для региона 46				рассчитайте урожайность пшеницы в 	1999 году, 	взяв для рассчета средние суммы активных температур 	за предыдущие 2 года, 	с  метеостанций в радиусе не более 150 км	
19. Шитенкова Анастасия – для региона 13				рассчитайте урожайность пшеницы в 	период с 1995 по 2015 год	взяв для рассчета средние суммы активных температур 	за эти годы, 	с 13 ближайших метеостанций	но убирая из рассчета активных температур дни с температурой ниже 10 градусов


[l1]:https://www.dropbox.com/s/erhs9hoj4vhrz0b/eddypro.csv?dl=1 
